<!DOCTYPE html>
<html>
<head>
    <meta Charset="UTF-8" name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <title>h5仅仅只调用相机</title>
    <style>
        img{
            width:200px;
        }
    </style>
</head>
<body>
    <input id="#input" type="file" accept="image/*" capture="camera">
<script type="text/javascript" src="../lib/exif.js"></script>
<script>
    var $input = document.getElementById('#input');

    var fileReader = new FileReader();

    var img = new Image();

    var file = null;

    $input.addEventListener('change',readFile,false);

    function readFile (event) {
         file = event.target.files[0];

        fileReader.readAsDataURL(file);
    }
    //读取文件成功
    fileReader.onload = function () {
        img.src = this.result;

        var imgNode = document.createElement('img');
        imgNode.src = this.result;
        document.body.appendChild(imgNode);
    }

    img.onload = function () {

        //图片拍摄方向
        var orient = getPhotoOrientation(this);

        //超过规定大小 压缩
        if (file.size >= 1024) {

            var canvas = document.createElement('canvas');

            var width = this.width,
                height = this.height;

            canvas.width = width;
            canvas.height = height;

            var ctx = canvas.getContext('2d');



            //原始图片是旋转的
            if (orient == '6') {

                var width_m = height / 2,
                    height_m = width / 2;

                canvas.width = height;
                canvas.height = width;

                ctx.save();

                ctx.translate(width_m, height_m);

                ctx.rotate(90 * Math.PI / 180);

                ctx.drawImage(img, -height_m, -width_m, width, height);

                ctx.restore();

            } else {
                ctx.drawImage(img, 0, 0, width, height);
            }


            var base = canvas.toDataURL('image/jpeg', 0.5);

            var imgNode = document.createElement('img');
            imgNode.src = base;
            imgNode.alt = 'fromCanvas';
            document.body.appendChild(imgNode);

        }
    }

    function getPhotoOrientation(img){
        var orient;
        EXIF.getData(img, function () {
            orient = EXIF.getTag(this, 'Orientation');
        });
        return orient;
    }

</script>
</body>
</html>